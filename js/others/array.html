<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>JS数组中那些你知道或不知道的 | 鱼头的Web海洋</title>
    <meta name="description" content="让你的Web学习如同玩耍在海洋一样快乐" />
    <link rel="icon" href="https://fish-pond-1253945200.cos.ap-guangzhou.myqcloud.com/base/blogfavicon.ico">
    
    <link rel="preload" href="/assets/css/0.styles.a57752fc.css" as="style"><link rel="preload" href="/assets/js/app.7bd542c9.js" as="script"><link rel="preload" href="/assets/js/32.2c64e26e.js" as="script"><link rel="prefetch" href="/assets/js/2.ee28eecc.js"><link rel="prefetch" href="/assets/js/3.4f75b704.js"><link rel="prefetch" href="/assets/js/4.f573eaec.js"><link rel="prefetch" href="/assets/js/5.478f5ac2.js"><link rel="prefetch" href="/assets/js/6.4c097f64.js"><link rel="prefetch" href="/assets/js/7.58a8b71c.js"><link rel="prefetch" href="/assets/js/8.3f46aa1d.js"><link rel="prefetch" href="/assets/js/9.b22bdfb2.js"><link rel="prefetch" href="/assets/js/10.66b6a51e.js"><link rel="prefetch" href="/assets/js/11.7e6ee11d.js"><link rel="prefetch" href="/assets/js/12.00a57e71.js"><link rel="prefetch" href="/assets/js/13.a3ebb5cb.js"><link rel="prefetch" href="/assets/js/14.24257f57.js"><link rel="prefetch" href="/assets/js/15.e9fbe090.js"><link rel="prefetch" href="/assets/js/16.3274933f.js"><link rel="prefetch" href="/assets/js/17.c44a15a9.js"><link rel="prefetch" href="/assets/js/18.9d746e2b.js"><link rel="prefetch" href="/assets/js/19.baae15bc.js"><link rel="prefetch" href="/assets/js/20.9aaca5ee.js"><link rel="prefetch" href="/assets/js/21.aec3f975.js"><link rel="prefetch" href="/assets/js/22.21ec2527.js"><link rel="prefetch" href="/assets/js/23.215265ec.js"><link rel="prefetch" href="/assets/js/24.32608e97.js"><link rel="prefetch" href="/assets/js/25.a29407a4.js"><link rel="prefetch" href="/assets/js/26.0ce95665.js"><link rel="prefetch" href="/assets/js/27.2bec40fe.js"><link rel="prefetch" href="/assets/js/28.37c3e242.js"><link rel="prefetch" href="/assets/js/29.25240822.js"><link rel="prefetch" href="/assets/js/30.b2239b28.js"><link rel="prefetch" href="/assets/js/31.3232657a.js"><link rel="prefetch" href="/assets/js/33.2f410f00.js"><link rel="prefetch" href="/assets/js/34.7bbb4327.js"><link rel="prefetch" href="/assets/js/35.31641123.js"><link rel="prefetch" href="/assets/js/36.ee53c3f2.js"><link rel="prefetch" href="/assets/js/37.1cc74cfa.js"><link rel="prefetch" href="/assets/js/38.9a4a47b9.js"><link rel="prefetch" href="/assets/js/39.1a9f045d.js"><link rel="prefetch" href="/assets/js/40.cf629f6b.js"><link rel="prefetch" href="/assets/js/41.014b5065.js"><link rel="prefetch" href="/assets/js/42.0e97650c.js"><link rel="prefetch" href="/assets/js/43.e9a09c8e.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a57752fc.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">鱼头的Web海洋</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><!----> <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>JS数组中那些你知道或不知道的</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/js/others/array.html#js中的array" class="sidebar-link">JS中的Array</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js/others/array.html#array" class="sidebar-link">Array()</a></li><li class="sidebar-sub-header"><a href="/js/others/array.html#array-len" class="sidebar-link">Array(len)</a></li><li class="sidebar-sub-header"><a href="/js/others/array.html#array-items" class="sidebar-link">Array(...items)</a></li><li class="sidebar-sub-header"><a href="/js/others/array.html#empty" class="sidebar-link">empty</a></li><li class="sidebar-sub-header"><a href="/js/others/array.html#以上总结" class="sidebar-link">以上总结</a></li></ul></li><li><a href="/js/others/array.html#类型转换" class="sidebar-link">类型转换</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js/others/array.html#转换为原始类型" class="sidebar-link">转换为原始类型</a></li><li class="sidebar-sub-header"><a href="/js/others/array.html#转换为布尔值" class="sidebar-link">转换为布尔值</a></li><li class="sidebar-sub-header"><a href="/js/others/array.html#转换为数字" class="sidebar-link">转换为数字</a></li><li class="sidebar-sub-header"><a href="/js/others/array.html#转换为字符串" class="sidebar-link">转换为字符串</a></li><li class="sidebar-sub-header"><a href="/js/others/array.html#数组的类型转换" class="sidebar-link">数组的类型转换</a></li></ul></li><li><a href="/js/others/array.html#关于api使用的一些经验与思考" class="sidebar-link">关于API使用的一些经验与思考</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js/others/array.html#loops" class="sidebar-link">loops</a></li><li class="sidebar-sub-header"><a href="/js/others/array.html#reduce" class="sidebar-link">reduce</a></li><li class="sidebar-sub-header"><a href="/js/others/array.html#性能" class="sidebar-link">性能</a></li></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="js数组中那些你知道或不知道的"><a href="#js数组中那些你知道或不知道的" aria-hidden="true" class="header-anchor">#</a> JS数组中那些你知道或不知道的</h1> <blockquote><ul><li>作者：陈大鱼头</li> <li>github： <a href="https://github.com/KRISACHAN" target="_blank" rel="noopener noreferrer">KRISACHAN<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></blockquote> <h2 id="js中的array"><a href="#js中的array" aria-hidden="true" class="header-anchor">#</a> JS中的Array</h2> <blockquote><p>ecma-262中的定义：</p> <p><strong>Array对象</strong>是一种特殊对象，它会对<strong>数组索引属性键</strong>进行特殊处理。</p> <p>每个<strong>Array对象</strong>都有一个不可配置的<strong>length</strong>属性，其最大值是<strong>2<sup>32</sup> - 1</strong>。</p></blockquote> <h3 id="array"><a href="#array" aria-hidden="true" class="header-anchor">#</a> Array()</h3> <blockquote><p>当且仅当不带参数调用Array构造函数时，此描述才适用。</p></blockquote> <p>执行过程：</p> <ol><li>定义 <strong>numberOfArgs</strong> 传递给此函数的调用的实参数量；</li> <li>断言： <strong>numberOfArgs</strong> 为 0；</li> <li>如果 <strong>NewTarget</strong> 为 <strong>undefined</strong> ，就设置 <strong>newTarget</strong> 为 <strong>活动函数对象（active-function-object，正在运行的执行上下文的函数组件）</strong> ，并且让 <strong>newTarget</strong> 成为 <strong>NewTarget</strong> ；</li> <li>原型 <strong>proto</strong> 怎么办？通过原生方法<code>GetPrototypeFromConstructor(newTarget, &quot;%ArrayPrototype%&quot;)</code>来构造；</li> <li>返回原生方法<code>ArrayCreate(0, proto)</code>。</li></ol> <p><strong>鱼头注：NewTarget是啥？NewTarget是原生Class FunctionCallbackInfo（函数调用的callback上下文的信息）内的一个不变量，用来定义构造调用时的返回值（new.target）。</strong></p> <h3 id="array-len"><a href="#array-len" aria-hidden="true" class="header-anchor">#</a> Array(len)</h3> <blockquote><p>当且仅当使用一个参数调用Array构造函数时，此描述才适用。</p></blockquote> <p>执行过程：</p> <ol><li>定义 <strong>numberOfArgs</strong> 为传递给此函数的调用的实参数量；</li> <li>断言： <strong>numberOfArgs</strong> 为1；</li> <li>如果 <strong>NewTarget</strong> 为 <strong>undefined</strong> ，就设置 <strong>newTarget</strong> 为 <strong>活动函数对象</strong> ，并且让 <strong>newTarget</strong> 成为 <strong>NewTarget</strong> ；</li> <li>原型 <strong>proto</strong> 怎么办？通过原生方法<code>GetPrototypeFromConstructor(newTarget, &quot;%ArrayPrototype%&quot;)</code>来构造；</li> <li>然后定义<strong>array</strong> 为<code>ArrayCreate(0, proto)</code>；</li> <li>如果 <strong>len</strong> 的类型不是个<strong>Number</strong>，则：
<ol><li>定义 <strong>defineStatus</strong> 为<strong>CreateDataProperty(array, &quot;0&quot;, len)</strong>；</li> <li>断言：<strong>defineStatus</strong>为真；</li> <li>让 <strong>intLen（初始化长度）</strong> 为1。</li></ol></li> <li>或者：
<ol><li>定义<strong>intLen</strong>为<strong>ToUint32(len)（原生方法，将len转换成0到2<sup>32</sup>-1之间的整数值）</strong>；</li> <li>如果<strong>intLen</strong>不等于<strong>len</strong>，抛出<strong>RangeError</strong>异常。</li></ol></li> <li>执行<strong>Set(array, &quot;length&quot;, intLen, true)（原生方法，给对象的属性赋值）</strong>；</li> <li>返回<strong>array</strong>。</li></ol> <h3 id="array-items"><a href="#array-items" aria-hidden="true" class="header-anchor">#</a> Array(...items)</h3> <blockquote><p>当且仅当使用至少两个参数调用Array构造函数时，此描述才适用。</p></blockquote> <p>执行过程：</p> <ol><li>定义 <strong>numberOfArgs</strong> 为传递给此函数的调用的实参数量；</li> <li>断言： <strong>numberOfArgs</strong> 大于等于2；</li> <li>如果 <strong>NewTarget</strong> 为 <strong>undefined</strong> ，就设置 <strong>newTarget</strong> 为 <strong>活动函数对象</strong> ，并且让 <strong>newTarget</strong> 成为 <strong>NewTarget</strong> ；</li> <li>原型 <strong>proto</strong> 怎么办？通过原生方法<code>GetPrototypeFromConstructor(newTarget, &quot;%ArrayPrototype%&quot;)</code>来构造；</li> <li>然后定义<strong>array</strong> 为<code>ArrayCreate(numberOfArgs, proto)</code>；</li> <li>定义 <strong>k</strong> 为0；</li> <li>定义 <strong>items</strong>为 正序传入参数的 <strong>零源（zero-origined）</strong> 列表；</li> <li>重复，当 <strong>k</strong> 小于 <strong>numberOfArgs</strong> <ol><li>定义 <strong>Pk</strong> 为 <strong>ToSting(k)</strong>；</li> <li>定义 <strong>itemK</strong> 为 <strong>item[k]</strong>；</li> <li>定义 <strong>defineStatus</strong> 为<strong>CreateDataProperty(array, Pk, itemK)</strong>;</li> <li>断言：<strong>defineStatus</strong>为真；</li> <li><strong>k</strong> 加1。</li></ol></li> <li>断言： <strong>array</strong>的 <strong>length</strong> 值为 <strong>numberOfArgs</strong>；</li> <li>返回 <strong>array</strong>。</li></ol> <h3 id="empty"><a href="#empty" aria-hidden="true" class="header-anchor">#</a> empty</h3> <blockquote><p>上面的三种情况以上便是构造Array()时不同情况的具体实现。但是我们从上面的断言可以知道，构造结果有可能为真，有可能为假。还有是定义指定长度数组时会出现什么事呢？</p></blockquote> <p>在<strong>V8源码 3.28.71(node0.12.18)<strong>中 <strong>Array</strong> 有个</strong>CloneElementAt</strong>的方法。定义如下：</p> <p><strong>在指定索引处克隆元素时，如果克隆失败，则返回一个空句柄（任何原因）。</strong></p> <p>从这句话我们可以知道，当我们构造一个指定长度的 <strong>Array</strong> 时，由于有长度，所以会开辟相应下标的空间，但是因为该下标并没有元素，所以就会返回<strong>empty</strong>，任何原因构造数组元素失败时，都会返回一个<strong>empty</strong>。</p> <p>示例如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
arr <span class="token comment">// [empty × 10]</span>
</code></pre></div><h3 id="以上总结"><a href="#以上总结" aria-hidden="true" class="header-anchor">#</a> 以上总结</h3> <p>上面是 <a href="https://www.ecma-international.org/ecma-262/9.0/index.html#sec-array-constructor" target="_blank" rel="noopener noreferrer">ECMA<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 上的定义以及 <strong>V8</strong> 源码的容错处理，其实简单来说就是：</p> <p><strong>调用 <code>Array(args)</code> 时：</strong></p> <ol><li>用原生方法 <code>GetPrototypeFromConstructor</code> 生成原型 <code>proto</code> ；</li> <li>判断 <code>args</code> 的类型；</li> <li>如果为 <code>undefined</code>，则直接返回创建数组的原生方法 <code>ArrayCreate</code>；</li> <li>如果为 <code>number</code>，则用原生方法 <code>Set</code> 创建 <code>args</code> 长度的数组，并通过原生方法 <code>CloneElementAt</code> 来创建 <strong>args</strong> 个 <strong>empty</strong> 作为数组元素，如果<code>args</code> 大于 <strong>2<sup>32</sup> - 1</strong> 的话，会报错；</li> <li>如果为其他类型，则把 <code>args</code> 变成数组元素，并用 原生方法 <code>CreateDataProperty</code> 创建参数，然后返回创建数组的原生方法 <code>ArrayCreate</code>。</li></ol> <h2 id="类型转换"><a href="#类型转换" aria-hidden="true" class="header-anchor">#</a> 类型转换</h2> <blockquote><p>类型转换是一个经常出现在一些网上常见面试题或者奇技淫巧中的内容。那么关于数组的类型转换，又是怎样的呢？</p></blockquote> <p>首先我们要知道，在 JS 中类型转换只有三种情况，分别是：</p> <ul><li>转换为布尔值</li> <li>转换为数字</li> <li>转换为字符串</li></ul> <h3 id="转换为原始类型"><a href="#转换为原始类型" aria-hidden="true" class="header-anchor">#</a> 转换为原始类型</h3> <p>对象在转换类型的时候，会执行原生方法<strong>ToPrimitive</strong>。</p> <p>其算法如下：</p> <ol><li>如果已经是 <strong>原始类型</strong>，则返回当前值；</li> <li>如果需要转 <strong>字符串</strong> 则先调用<code>toSting</code>方法，如果此时是 <strong>原始类型</strong> 则直接返回，否则再调用<code>valueOf</code>方法并返回结果；</li> <li>如果不是 <strong>字符串</strong>，则先调用<code>valueOf</code>方法，如果此时是 <strong>原始类型</strong> 则直接返回，否则再调用<code>toString</code>方法并返回结果；</li> <li>如果都没有 <strong>原始类型</strong> 返回，则抛出 <strong>TypeError</strong>类型错误。</li></ol> <p>当然，我们可以通过重写<code>Symbol.toPrimitive</code>来制定转换规则，此方法在转原始类型时调用优先级最高。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 下面例子来自YCK的小册</span>
<span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">valueOf</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">toString</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'1'</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>toPrimitive<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
data <span class="token operator">+</span> <span class="token number">1</span> <span class="token comment">// 3</span>
</code></pre></div><h3 id="转换为布尔值"><a href="#转换为布尔值" aria-hidden="true" class="header-anchor">#</a> 转换为布尔值</h3> <p>对象转换为布尔值的规则如下表：</p> <table><thead><tr><th>参数类型</th> <th>结果</th></tr></thead> <tbody><tr><td>Undefined</td> <td>返回 <code>false</code>。</td></tr> <tr><td>Null</td> <td>返回 <code>false</code>。</td></tr> <tr><td>Boolean</td> <td>返回 当前参数。</td></tr> <tr><td>Number</td> <td>如果参数为<code>+0</code>、<code>-0</code>或<code>NaN</code>，则返回 <code>false</code>；其他情况则返回 <code>true</code>。</td></tr> <tr><td>String</td> <td>如果参数为空字符串，则返回 <code>false</code>；否则返回 <code>true</code>。</td></tr> <tr><td>Symbol</td> <td>返回 <code>true</code>。</td></tr> <tr><td>Object</td> <td>返回 <code>true</code>。</td></tr></tbody></table> <h3 id="转换为数字"><a href="#转换为数字" aria-hidden="true" class="header-anchor">#</a> 转换为数字</h3> <p>对象转换为数字的规则如下表：</p> <table><thead><tr><th>参数类型</th> <th>结果</th></tr></thead> <tbody><tr><td>Undefined</td> <td>返回 <code>NaN</code>。</td></tr> <tr><td>Null</td> <td>Return +0.</td></tr> <tr><td>Boolean</td> <td>如果参数为 <code>true</code>，则返回 <code>1</code>；<code>false</code>则返回 <code>+0</code>。</td></tr> <tr><td>Number</td> <td>返回当前参数。</td></tr> <tr><td>String</td> <td>先调用 <strong>ToPrimitive</strong>，再调用 <strong>ToNumber</strong>，然后返回结果。</td></tr> <tr><td>Symbol</td> <td>抛出 <code>TypeError</code>错误。</td></tr> <tr><td>Object</td> <td>先调用 <strong>ToPrimitive</strong>，再调用 <strong>ToNumber</strong>，然后返回结果。</td></tr></tbody></table> <h3 id="转换为字符串"><a href="#转换为字符串" aria-hidden="true" class="header-anchor">#</a> 转换为字符串</h3> <p>对象转换为字符串的规则如下表：</p> <table><thead><tr><th>参数类型</th> <th>结果</th></tr></thead> <tbody><tr><td>Undefined</td> <td>返回 <code>&quot;undefined&quot;</code>。</td></tr> <tr><td>Null</td> <td>返回 <code>&quot;null&quot;</code>。</td></tr> <tr><td>Boolean</td> <td>如果参数为 <code>true</code> ,则返回 <code>&quot;true&quot;</code>；否则返回 <code>&quot;false&quot;</code>。</td></tr> <tr><td>Number</td> <td>调用 <strong>NumberToString</strong>，然后返回结果。</td></tr> <tr><td>String</td> <td>返回 当前参数。</td></tr> <tr><td>Symbol</td> <td>抛出 <code>TypeError</code>错误。</td></tr> <tr><td>Object</td> <td>先调用 <strong>ToPrimitive</strong>，再调用 <strong>ToString</strong>，然后返回结果。</td></tr></tbody></table> <h3 id="数组的类型转换"><a href="#数组的类型转换" aria-hidden="true" class="header-anchor">#</a> 数组的类型转换</h3> <p>所以通过上面的转换规则，我们是否能够轻松地看懂以下的隐式转换呢？</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token punctuation">{</span>a<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">}</span> <span class="token comment">// &quot;1,2,3[object Object]&quot;</span>
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token comment">// &quot;1,2,31&quot;</span>
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token boolean">true</span> <span class="token comment">// &quot;1,2,3true&quot;</span>
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">+</span> undefined <span class="token comment">// &quot;1,2,3undefined&quot;</span>
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token keyword">null</span> <span class="token comment">// &quot;1,2,3null&quot;</span>
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">'123'</span> <span class="token comment">// &quot;1,2,3123&quot;</span>
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'biu'</span><span class="token punctuation">)</span> <span class="token comment">// &quot;Uncaught TypeError&quot;</span>
</code></pre></div><p><strong>所以各位是否理解上述隐式转换的答案呢？</strong></p> <h2 id="关于api使用的一些经验与思考"><a href="#关于api使用的一些经验与思考" aria-hidden="true" class="header-anchor">#</a> 关于API使用的一些经验与思考</h2> <blockquote><p>JS数组自带了很多的方法，在现代工程化数据驱动的理念下，这些方法都是非常重要的。</p></blockquote> <h3 id="loops"><a href="#loops" aria-hidden="true" class="header-anchor">#</a> loops</h3> <p><code>forEach</code>是 <strong>Array</strong> 方法中比较基本的一个，作用也很简单，与<code>for</code>，就是遍历，循环。不同的是，<code>forEach</code>可以选择自定义上下文环境。例子如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> arr1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>；
<span class="token keyword">var</span> arr2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span>；
arr1<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>e<span class="token punctuation">,</span> i<span class="token punctuation">,</span> a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// this为arr2</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> arr2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>但是如果<code>forEach</code>的回调函数是用箭头函数定义的，那么就无法改变它原本指向的上下文环境。例子如下：</p> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> arr1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>；
<span class="token keyword">var</span> arr2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span>；
arr1<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> i<span class="token punctuation">,</span> a<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// this为window对象</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> arr2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>所以如果我们要实现以下这个功能：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!--
点击当前li时，当前li文字变色，其余兄弟li变回默认颜色
--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>3<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>4<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>5<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript">
    <span class="token string">'use strict'</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> ul <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'ul'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ul<span class="token punctuation">.</span><span class="token function-variable function">onClick</span> <span class="token operator">=</span> event <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> cls <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>className<span class="token punctuation">;</span>
        ul<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>el <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>color <span class="token operator">=</span> <span class="token punctuation">(</span>cls <span class="token operator">===</span> el<span class="token punctuation">.</span>className <span class="token operator">?</span> <span class="token string">'#FFF'</span> <span class="token punctuation">:</span> <span class="token string">'#FF0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>在ES6以前的环境中，如果直接用<code>for</code>循环，会出现只能获取到最后一个元素的问题，但是用<code>forEach</code>则没有这个问题。</p> <h3 id="reduce"><a href="#reduce" aria-hidden="true" class="header-anchor">#</a> reduce</h3> <p><strong>Array</strong> ES5 API <code>reduce</code>跟<code>reduceRight</code>，可以轻松实现并归元素的功能，例子如下：</p> <p>如果我们需要实现一个这样的对象：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
    a<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    b<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    c<span class="token punctuation">:</span> <span class="token number">3</span>
    <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>那么用reduce就会变得很简单：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> newArr <span class="token operator">=</span> <span class="token string">'a,b,c,d,e,f'</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>acc<span class="token punctuation">,</span> cur<span class="token punctuation">,</span> idx<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> o <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Object<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>toString<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>acc<span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token string">'[object Object]'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        o<span class="token punctuation">[</span>cur<span class="token punctuation">]</span> <span class="token operator">=</span> idx<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> newO <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        newO<span class="token punctuation">[</span>cur<span class="token punctuation">]</span> <span class="token operator">=</span> idx<span class="token punctuation">;</span>
        o <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token operator">...</span>acc<span class="token punctuation">,</span>
            <span class="token operator">...</span>newO<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> o<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="性能"><a href="#性能" aria-hidden="true" class="header-anchor">#</a> 性能</h3> <p>上面演示了通过JS数组API实现的一些功能，所以与<code>for</code>循环比性能如何呢？</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
arr<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>data <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>所以哪个更耗时间呢？</p> <p>在公布结果之前，其实网上一直流传着<strong>for循环性能比forEach性能好，考虑性能少用forEach</strong>的言论，其实以前的浏览器也是这种情况。</p> <p>详情可以看知乎的这篇评论：<a href="https://www.zhihu.com/question/54637225/answer/140362071" target="_blank" rel="noopener noreferrer">https://www.zhihu.com/question/54637225/answer/140362071<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><strong>性能对比如下：</strong></p> <p>以下代码测试环境为：<strong>Chrome 55.0.2883 / Windows 7 0.0.0</strong></p> <p><img src="https://fish-pond-1253945200.cos.ap-guangzhou.myqcloud.com/img/js/1.png" alt="1"></p> <p>所以在9012年的如今，结果又会是如何呢？</p> <p>以下代码测试环境为：<strong>Chrome 73.0.3683 / Windows 10 0.0.0</strong></p> <p><img src="https://fish-pond-1253945200.cos.ap-guangzhou.myqcloud.com/img/js/2.png" alt="wx-qrcode"></p> <p>通过上面的对比，结果已经很明显了，我们要知道，现代的浏览器性能优化已经做得比以前好很多了，再加上电子设备本身的硬件也越来越好，所以代码块的性能不是我们首要的考虑因素。</p> <p>在跟同行沟通的过程中，经常会看到有人为了扣那么一个两个表达式的性能而烦恼，其实是这是没有任何必要，原因也如上，我们应该优化的是我们表达式是否清晰明了，是否适合后期维护或拓展。</p> <p>如果你喜欢探讨技术，或者对本文有任何的意见或建议，非常欢迎加鱼头微信好友一起探讨，当然，鱼头也非常希望能跟你一起聊生活，聊爱好，谈天说地。
鱼头的微信号是：krisChans95
也可以扫码关注公众号，订阅更多精彩内容。
<img src="https://fish-pond-1253945200.cos.ap-guangzhou.myqcloud.com/img/base/qrcode-all1.png" alt="https://fish-pond-1253945200.cos.ap-guangzhou.myqcloud.com/img/base/qrcode-all1.png"></p></div> <div class="page-footer content">
    网站备案号：粤ICP备17113436号-1
  </div> <!----> <div class="right-group"><div class="item"><span class="title">加入前端鱼塘</span> <span class="desc">
        扫描二维码回复
        <span class="inner">加群</span> 学习
      </span> <img width="100%" src="https://fish-pond-1253945200.cos.ap-guangzhou.myqcloud.com/img/base/wx-qrcode.jpg"></div></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <div></div></div></div>
    <script src="/assets/js/32.2c64e26e.js" defer></script><script src="/assets/js/app.7bd542c9.js" defer></script>
    <!-- Hotjar Tracking Code for yuchengkai.cn -->
    <script>
      var _hmt = _hmt || []
      ;(function() {
        var hm = document.createElement('script')
        hm.src = 'https://hm.baidu.com/hm.js?52ee35894430604d0d3ce3b9c089adf9'
        var s = document.getElementsByTagName('script')[0]
        s.parentNode.insertBefore(hm, s)
      })()
    </script>
  </body>
</html>
