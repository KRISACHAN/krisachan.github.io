<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>像监听页面一样监听戈多的动态 | 鱼头的海上世界</title>
    <meta name="description" content="kris&#39;s area">
    <link rel="icon" href="https://fish-pond-1253945200.cos.ap-guangzhou.myqcloud.com/base/blogfavicon.ico">
    
    <link rel="preload" href="/assets/css/styles.f4653b21.css" as="style"><link rel="preload" href="/assets/js/app.f4653b21.js" as="script"><link rel="preload" href="/assets/js/24.f566c6f7.js" as="script"><link rel="prefetch" href="/assets/js/1.88a9e7b3.js"><link rel="prefetch" href="/assets/js/10.0f0ea6b5.js"><link rel="prefetch" href="/assets/js/11.4a63817b.js"><link rel="prefetch" href="/assets/js/12.05b835b7.js"><link rel="prefetch" href="/assets/js/13.227ad9e9.js"><link rel="prefetch" href="/assets/js/14.c55b0f71.js"><link rel="prefetch" href="/assets/js/15.ca3a7810.js"><link rel="prefetch" href="/assets/js/16.31272ad9.js"><link rel="prefetch" href="/assets/js/17.d356460f.js"><link rel="prefetch" href="/assets/js/18.b0d2de34.js"><link rel="prefetch" href="/assets/js/19.be240ab2.js"><link rel="prefetch" href="/assets/js/2.29ee4ec8.js"><link rel="prefetch" href="/assets/js/20.5b587493.js"><link rel="prefetch" href="/assets/js/21.a75f3f7b.js"><link rel="prefetch" href="/assets/js/22.11c9b067.js"><link rel="prefetch" href="/assets/js/23.1d4b1ff6.js"><link rel="prefetch" href="/assets/js/25.2344afa6.js"><link rel="prefetch" href="/assets/js/26.aa1c7dac.js"><link rel="prefetch" href="/assets/js/27.9b70d93b.js"><link rel="prefetch" href="/assets/js/3.adbff861.js"><link rel="prefetch" href="/assets/js/4.7928c957.js"><link rel="prefetch" href="/assets/js/5.6433fa86.js"><link rel="prefetch" href="/assets/js/6.2d1a008f.js"><link rel="prefetch" href="/assets/js/7.b0761e13.js"><link rel="prefetch" href="/assets/js/8.bc6df668.js"><link rel="prefetch" href="/assets/js/9.f97fdb3b.js">
    <link rel="stylesheet" href="/assets/css/styles.f4653b21.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/" class="home-link router-link-active"><!----><span class="site-name">
      鱼头的海上世界
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><!----></div></header><div class="sidebar-mask"></div><div class="sidebar"><!----><ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>像监听页面一样监听戈多的动态</span><!----></p><ul class="sidebar-group-items"><li><a href="/js/others/godot.html#object-defineproperty" class="sidebar-link">Object.defineProperty</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/js/others/godot.html#mutationobserver" class="sidebar-link">MutationObserver</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/js/others/godot.html#mutation-events" class="sidebar-link">Mutation events</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/js/others/godot.html#intersection-observer" class="sidebar-link">Intersection Observer</a><ul class="sidebar-sub-headers"></ul></li></ul></div></li></ul></div><div class="page"><div class="content"><h1 id="像监听页面一样监听戈多的动态"><a href="#像监听页面一样监听戈多的动态" aria-hidden="true" class="header-anchor">#</a> 像监听页面一样监听戈多的动态</h1><blockquote><ul><li>作者：陈大鱼头</li><li>github： <a href="https://github.com/KRISACHAN" target="_blank" rel="noopener noreferrer">KRISACHAN<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></blockquote><p>不知道各位童鞋有木有看过 <strong>《等待戈多》</strong> 这部出名的荒诞戏剧 。其剧情大概就是 戈戈 与 狄狄 等待 戈多 的过程中发生的一些琐事，一共两幕。等了这么多年，也不知道 戈多 现在在哪，赴约了没有。</p><p>如果 戈戈 与 狄狄 像我们监听页面元素变化那样监听戈多的动态，是不是就不会出现空欢喜的状态？是不是就不用等得那么辛苦？是不是甚至可以主动去寻找戈多？</p><p><img src="https://fish-pond-1253945200.cos.ap-guangzhou.myqcloud.com/js/godot/wait.jpg" alt="wait"></p><p>说起监听页面元素变化，那么你可知道有哪些方法可以实现这个功能？</p><h2 id="object-defineproperty"><a href="#object-defineproperty" aria-hidden="true" class="header-anchor">#</a> Object.defineProperty</h2><p>关于 <strong><code>Object.defineProperty</code></strong> 这个属性大家应该很熟（毕竟是各类面经中的常客），但还是要简单介绍下~</p><p><strong><code>Object.defineProperty</code></strong> 允许精确添加或修改对象的属性。通过赋值操作添加的普通属性是可枚举的，能够在属性枚举期间呈现出来。</p><p>描述符可同时具有的键值：</p><table><thead><tr><th></th><th>configurable</th><th>enumerable</th><th>value</th><th>writable</th><th>get</th><th>set</th></tr></thead><tbody><tr><td>数据描述符</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td><td>No</td><td>No</td></tr><tr><td>存取描述符</td><td>Yes</td><td>Yes</td><td>No</td><td>No</td><td>Yes</td><td>Yes</td></tr></tbody></table><p>所以我们有以下这种效果：</p><p><img src="https://fish-pond-1253945200.cos.ap-guangzhou.myqcloud.com/js/godot/gd1.gif" alt="gd1"></p><p>代码如下：</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token string">'use strict'</span>
Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>godot<span class="token punctuation">,</span> <span class="token string">'style'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">'style'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">set</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'style'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>
        <span class="token keyword">const</span> distance <span class="token operator">=</span> <span class="token punctuation">(</span>noLeftTree<span class="token punctuation">.</span>offsetLeft <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>offsetLeft<span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>distance <span class="token operator">&gt;=</span> <span class="token number">51</span> <span class="token operator">?</span> <span class="token string">'戈多没来，我们先各自干各自的活吧'</span> <span class="token punctuation">:</span> <span class="token string">'戈多快到了，走，我们集合去'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">whereIsGodot</span> <span class="token operator">=</span> start <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>start<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> d <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">const</span> <span class="token function-variable function">godotRun</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>noLeftTree<span class="token punctuation">.</span>offsetLeft <span class="token operator">-</span> <span class="token number">51</span> <span class="token operator">&gt;=</span> d<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    d<span class="token operator">++</span>
                    godot<span class="token punctuation">.</span>style <span class="token operator">=</span> <span class="token template-string"><span class="token string">`left: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>d<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px`</span></span>
                    <span class="token function">godotRun</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token function">godotRun</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>简单来说就是使用 <strong><code>Object.defineProperty</code></strong> 监听戈多的位置变化，然后当戈多移动到集合地点附近时，等待戈多的俩哥们就可以去赴约了。通过上述的代码，我们可以知道 <code>whereIsGodot</code> 函数只负责戈多的位置移动，但是监听权在等待戈多的两个人那里，这样保证了代码语义化的同时，耦合度也尽可能地小。（代码不太雅观，但纯属为了效果演示而写，求轻喷）</p><h2 id="mutationobserver"><a href="#mutationobserver" aria-hidden="true" class="header-anchor">#</a> MutationObserver</h2><h2 id="mutation-events"><a href="#mutation-events" aria-hidden="true" class="header-anchor">#</a> Mutation events</h2><h2 id="intersection-observer"><a href="#intersection-observer" aria-hidden="true" class="header-anchor">#</a> Intersection Observer</h2><p>如果你、喜欢探讨技术，或者对本文有任何的意见或建议，你可以扫描下方二维码，关注微信公众号“ <strong>鱼头的Web海洋</strong> ”，随时与鱼头互动。欢迎！衷心希望可以遇见你。</p><p><img src="https://fish-pond-1253945200.cos.ap-guangzhou.myqcloud.com/img/base/qrcode-base.png" alt="qrcode-base"></p></div><div class="page-edit"><!----><!----></div><!----></div></div></div>
    <script src="/assets/js/app.f4653b21.js" defer></script><script src="/assets/js/24.f566c6f7.js" defer></script>
  </body>
</html>
