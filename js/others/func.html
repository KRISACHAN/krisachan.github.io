<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>5 个提升你 JS 编码水平的实例 | 鱼头的Web海洋</title>
    <meta name="description" content="让你的Web学习如同玩耍在海洋一样快乐" />
    <link rel="icon" href="https://fish-pond-1253945200.cos.ap-guangzhou.myqcloud.com/base/blogfavicon.ico">
    
    <link rel="preload" href="/assets/css/0.styles.a57752fc.css" as="style"><link rel="preload" href="/assets/js/app.c5a7454e.js" as="script"><link rel="preload" href="/assets/js/35.31641123.js" as="script"><link rel="prefetch" href="/assets/js/2.ee28eecc.js"><link rel="prefetch" href="/assets/js/3.4f75b704.js"><link rel="prefetch" href="/assets/js/4.f573eaec.js"><link rel="prefetch" href="/assets/js/5.478f5ac2.js"><link rel="prefetch" href="/assets/js/6.4c097f64.js"><link rel="prefetch" href="/assets/js/7.58a8b71c.js"><link rel="prefetch" href="/assets/js/8.3f46aa1d.js"><link rel="prefetch" href="/assets/js/9.b22bdfb2.js"><link rel="prefetch" href="/assets/js/10.66b6a51e.js"><link rel="prefetch" href="/assets/js/11.7e6ee11d.js"><link rel="prefetch" href="/assets/js/12.00a57e71.js"><link rel="prefetch" href="/assets/js/13.a3ebb5cb.js"><link rel="prefetch" href="/assets/js/14.24257f57.js"><link rel="prefetch" href="/assets/js/15.e9fbe090.js"><link rel="prefetch" href="/assets/js/16.3274933f.js"><link rel="prefetch" href="/assets/js/17.c44a15a9.js"><link rel="prefetch" href="/assets/js/18.9d746e2b.js"><link rel="prefetch" href="/assets/js/19.baae15bc.js"><link rel="prefetch" href="/assets/js/20.9aaca5ee.js"><link rel="prefetch" href="/assets/js/21.aec3f975.js"><link rel="prefetch" href="/assets/js/22.21ec2527.js"><link rel="prefetch" href="/assets/js/23.215265ec.js"><link rel="prefetch" href="/assets/js/24.32608e97.js"><link rel="prefetch" href="/assets/js/25.a29407a4.js"><link rel="prefetch" href="/assets/js/26.0ce95665.js"><link rel="prefetch" href="/assets/js/27.2bec40fe.js"><link rel="prefetch" href="/assets/js/28.37c3e242.js"><link rel="prefetch" href="/assets/js/29.25240822.js"><link rel="prefetch" href="/assets/js/30.b2239b28.js"><link rel="prefetch" href="/assets/js/31.3232657a.js"><link rel="prefetch" href="/assets/js/32.2c64e26e.js"><link rel="prefetch" href="/assets/js/33.2f410f00.js"><link rel="prefetch" href="/assets/js/34.7bbb4327.js"><link rel="prefetch" href="/assets/js/36.ee53c3f2.js"><link rel="prefetch" href="/assets/js/37.1cc74cfa.js"><link rel="prefetch" href="/assets/js/38.9a4a47b9.js"><link rel="prefetch" href="/assets/js/39.1a9f045d.js"><link rel="prefetch" href="/assets/js/40.cf629f6b.js"><link rel="prefetch" href="/assets/js/41.014b5065.js"><link rel="prefetch" href="/assets/js/42.0e97650c.js"><link rel="prefetch" href="/assets/js/43.e9a09c8e.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a57752fc.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">鱼头的Web海洋</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><!----> <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>5 个提升你 JS 编码水平的实例</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/js/others/func.html#判断数据类型" class="sidebar-link">判断数据类型</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/js/others/func.html#通用的数组-类数组对象封装" class="sidebar-link">通用的数组/类数组对象封装</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/js/others/func.html#获取-dom-元素节点的偏移量" class="sidebar-link">获取 dom 元素节点的偏移量</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/js/others/func.html#fade-特效" class="sidebar-link">Fade 特效</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/js/others/func.html#利用队列的概念进行数据操作" class="sidebar-link">利用队列的概念进行数据操作</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js/others/func.html#获取节点在该父节点下的坐标。" class="sidebar-link">获取节点在该父节点下的坐标。</a></li><li class="sidebar-sub-header"><a href="/js/others/func.html#清空子节点" class="sidebar-link">清空子节点</a></li></ul></li><li><a href="/js/others/func.html#利用-reduce-进行数据优化" class="sidebar-link">利用 reduce 进行数据优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js/others/func.html#数组去重" class="sidebar-link">数组去重</a></li></ul></li><li><a href="/js/others/func.html#牛逼的-reduce" class="sidebar-link">牛逼的 reduce</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js/others/func.html#数据去重" class="sidebar-link">数据去重</a></li><li class="sidebar-sub-header"><a href="/js/others/func.html#批量生成对象元素" class="sidebar-link">批量生成对象元素</a></li></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="_5-个提升你-js-编码水平的实例"><a href="#_5-个提升你-js-编码水平的实例" aria-hidden="true" class="header-anchor">#</a> 5 个提升你 JS 编码水平的实例</h1> <blockquote><ul><li>作者：陈大鱼头</li> <li>github： <a href="https://github.com/KRISACHAN" target="_blank" rel="noopener noreferrer">KRISACHAN<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></blockquote> <p>虽然 2020 的今天，各种前端框架、工具林立，而这些框架跟工具也帮我们提前解决了不少麻烦的问题，但是工具始终是工具，扎实的基本功才是最核心的，现在一起来通过几个实际的代码片段来提高我们原生 JS 的编码水平。</p> <h2 id="判断数据类型"><a href="#判断数据类型" aria-hidden="true" class="header-anchor">#</a> 判断数据类型</h2> <p>首先来提问一个：<code>typeof</code>是否能正确判断类型？</p> <p>答案是：不可以，因为由于历史原因，在判断原始类型时，<code>typeof null</code>会等于<code>object</code>。而且对于对象来说，除了函数，都会转换成<code>object</code>。例子如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">typeof</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// 'number'</span>
<span class="token keyword">typeof</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 'string'</span>
<span class="token keyword">typeof</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">//</span>

<span class="token keyword">typeof</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 'object'</span>
<span class="token keyword">typeof</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 'object'</span>
<span class="token keyword">typeof</span> window<span class="token punctuation">.</span>alert<span class="token punctuation">;</span> <span class="token comment">// 'function'</span>
</code></pre></div><p>再来提问一个，<code>instanceof</code>是否能正确判断类型？</p> <p>答案是：还是不可以，虽然<code>instanceof</code>是通过原型链来判断的，但是对于对象来说，<code>Array</code>也会被转换成<code>Object</code>，而且也不能区分基本类型<code>string</code>和<code>boolean</code>。例如：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">const</span> func <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>func <span class="token keyword">instanceof</span> <span class="token class-name">Func</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>

<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
obj <span class="token keyword">instanceof</span> <span class="token class-name">Object</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
arr <span class="token keyword">instanceof</span> <span class="token class-name">Object</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
arr <span class="token keyword">instanceof</span> <span class="token class-name">Array</span><span class="token punctuation">;</span> <span class="token comment">// true</span>

<span class="token keyword">const</span> str <span class="token operator">=</span> <span class="token string">&quot;abc&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> str2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">&quot;abc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
str <span class="token keyword">instanceof</span> <span class="token class-name">String</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
str2 <span class="token keyword">instanceof</span> <span class="token class-name">String</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre></div><p>所以该怎么办呢？</p> <p>这时候我们可以使用：<code>Object.prototype.toString.call()</code></p> <p>所以为什么？</p> <p>因为每个对象都有一个<code>toString()</code>方法，当要将对象表示为文本值或以预期字符串的方式引用对象时，会自动调用该方法。默认情况下，从<code>Object</code>派生的每个对象都会继承<code>toString()</code>方法。如果此方法未在自定义对象中被覆盖，则<code>toString()</code>返回<code>[Object type]</code>，其中<code>type</code>是对象类型。所以就有以下例子：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>Object<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>toString<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [object Date]</span>
Object<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>toString<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [object String]</span>
Object<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>toString<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [object Numer]</span>
Object<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>toString<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>undefined<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [object Undefined]</span>
Object<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>toString<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [object Null]</span>
</code></pre></div><p>所以综合上述知识点，我们可以封装出以下通用类型判断方法：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> <span class="token function-variable function">type</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> toString <span class="token operator">=</span> Object<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>toString<span class="token punctuation">;</span>
      <span class="token keyword">var</span> dataType <span class="token operator">=</span> data <span class="token keyword">instanceof</span> <span class="token class-name">Element</span>
          				<span class="token operator">?</span> <span class="token string">'element'</span> <span class="token comment">// 为了统一DOM节点类型输出</span>
          				<span class="token punctuation">:</span> toString
              				<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
              				<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/\[object\s(.+)\]/</span><span class="token punctuation">,</span> <span class="token string">''</span>$<span class="token number">1</span>'<span class="token punctuation">)</span>
              				<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> dataType
<span class="token punctuation">}</span>
</code></pre></div><p>使用方法如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// string</span>
<span class="token function">type</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// number</span>
<span class="token function">type</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// window</span>
<span class="token function">type</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;h1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// element</span>
</code></pre></div><h2 id="通用的数组-类数组对象封装"><a href="#通用的数组-类数组对象封装" aria-hidden="true" class="header-anchor">#</a> 通用的数组/类数组对象封装</h2> <p>如果我们使用 ES5/ES6+的数组 API，很容易就能够对数组进行各类的循环操作，但是如果我们要循环一个类数组对象呢？</p> <p>例如<code>NodeList</code>。直接循环是会报错的：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>e <span class="token operator">=&gt;</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Uncaught TypeError: document.querySelectorAll(...).map is not a function</span>
</code></pre></div><p>当然我们可以用扩展运算符：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">[</span><span class="token operator">...</span>document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>e <span class="token operator">=&gt;</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>那如果我们不用扩展运算符呢？</p> <p>那么我们就可以利用<code>call</code>的特性，将<code>NodeList</code>里的元素一个一个的插入到数组中，例子如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> <span class="token function-variable function">listMap</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> type<span class="token punctuation">,</span> fn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token operator">!</span>fn <span class="token operator">?</span> array <span class="token punctuation">:</span> Array<span class="token punctuation">.</span>prototype<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;call&quot;</span><span class="token punctuation">]</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>使用方法如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> divs <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">listMap</span><span class="token punctuation">(</span>divs<span class="token punctuation">,</span> <span class="token string">&quot;forEach&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="获取-dom-元素节点的偏移量"><a href="#获取-dom-元素节点的偏移量" aria-hidden="true" class="header-anchor">#</a> 获取 dom 元素节点的偏移量</h2> <p>如果有用过<code>jQuery</code>的童鞋，就一定不会忘记<code>$('').offset()</code>这个 api 的强大功能，这个 api 可以轻易获取元素的偏移量，那么如果我们不用<code>jQuery</code>该怎么实现呢？</p> <p>我们先来看看例子：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> <span class="token function-variable function">getOffset</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> scrollTop <span class="token operator">=</span>
    el<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>top <span class="token operator">+</span>
    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>scrollTop <span class="token operator">+</span>
    document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>scrollTop<span class="token punctuation">;</span>
  <span class="token keyword">var</span> scrollLeft <span class="token operator">=</span>
    el<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>left <span class="token operator">+</span>
    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>scrollLeft <span class="token operator">+</span>
    document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>scrollLeft<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    top<span class="token punctuation">:</span> scrollTop<span class="token punctuation">,</span>
    left<span class="token punctuation">:</span> scrollLeft
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>首先我们先来看<code>getBoundingClientRect()</code>这个方法。</p> <p><code>getBoundingClientRect()</code>方法返回元素的大小及其相对于视口的位置。返回值是一个 <code>DOMRect</code> 对象，是与该元素相关的 CSS 边框集合 。</p> <p>然后就是<code>document.body.scrollTop</code> 跟 <code>document.documentElement.scrollTop</code>这两个是一个功能，只不过在不同的浏览器下会有一个始终为 0，所以做了以上的兼容性处理。所以当我们做拖拽功能的时候，就可以依赖上以上属性。</p> <p>使用方法如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;.moveBox&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">getOffset</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// {top: xxx, left: xxx}</span>
</code></pre></div><p><img src="https://fish-pond-1253945200.cos.ap-guangzhou.myqcloud.com/img/js/func/joystick.gif" alt></p> <p>我们可以看上面的摇杆效果，这里就是利用了<code>offset()</code>去做位置判断。具体实现代码可以看：https://codepen.io/krischan77/pen/zYxPNPy</p> <h2 id="fade-特效"><a href="#fade-特效" aria-hidden="true" class="header-anchor">#</a> Fade 特效</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// Fade in</span>
<span class="token keyword">var</span> <span class="token function-variable function">fadeIn</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>el<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>opacity <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">var</span> last <span class="token operator">=</span> <span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> <span class="token function-variable function">tick</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>opacity <span class="token operator">=</span> <span class="token operator">+</span>el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>opacity <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> last<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">400</span>
        last <span class="token operator">=</span> <span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">+</span>el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>opacity <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>tick<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token function">tick</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// Fade out</span>
<span class="token keyword">var</span> <span class="token function-variable function">fadeOut</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>el<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>opacity <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token keyword">var</span> last <span class="token operator">=</span> <span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> <span class="token function-variable function">tick</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>opacity <span class="token operator">=</span> <span class="token operator">+</span>el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>opacity <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> last<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">400</span>
        last <span class="token operator">=</span> <span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">+</span>el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>opacity <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>tick<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token function">tick</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上述是淡入淡出效果的具体实现，这里是利用<code>requestAnimationFrame</code>对<code>opacity</code>通过递归的方式进行修改。</p> <p>其实这里需要提一个概念，就是<strong>时间分片</strong>。</p> <p>这是一个非常重要的概念，例如 <strong>React</strong> 的 <strong>Fiber</strong> 核心实现就是<strong>时间分片</strong>。它会将一个长任务切分成一个含有若干小任务的任务队列，然后一个接着一个的执行。</p> <p><code>requestAnimationFrame</code>就是这样一个 API，它可以根据系统来决定回调函数的执行时机，其实也就是在下一次重绘之前更新动画帧，因为有这样的机制，所以能防止丢帧。</p> <h2 id="利用队列的概念进行数据操作"><a href="#利用队列的概念进行数据操作" aria-hidden="true" class="header-anchor">#</a> 利用队列的概念进行数据操作</h2> <p>队列（queue），是先进先出（FIFO, First-In-First-Out）的线性表。在具体应用中通常用链表或者数组来实现。队列只允许在后端（称为 rear）进行插入操作，在前端（称为 front）进行删除操作。</p> <p>虽然很多人觉得了解数据结构对前端作用不大，但是如果我们懂一些基础的概念，是否在编码时能够更加扩散我们的思维呢？我们看下面两个例子：</p> <h3 id="获取节点在该父节点下的坐标。"><a href="#获取节点在该父节点下的坐标。" aria-hidden="true" class="header-anchor">#</a> 获取节点在该父节点下的坐标。</h3> <p>如果我们要操作原生 DOM，那么是绕不开获取节点在该父节点的下标的这个功能的，那么我们该如何实现呢？</p> <p>当然就是利用我们的循环啦，对子元素集合进行遍历，直到确定下标为止，代码如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> <span class="token function-variable function">index</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>el<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>el <span class="token operator">=</span> el<span class="token punctuation">.</span>previousElementSibling<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    i<span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> i<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="清空子节点"><a href="#清空子节点" aria-hidden="true" class="header-anchor">#</a> 清空子节点</h3> <p>如果我们要清空某个 DOM 节点的子节点，我们有以下的方法：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> <span class="token function-variable function">empty</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>el<span class="token punctuation">.</span>firstChild<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    el<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>firstChild<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>上面只是提供一个思路，其实<code>el.innerHTML = ''</code>会更简洁。</strong></p> <h2 id="利用-reduce-进行数据优化"><a href="#利用-reduce-进行数据优化" aria-hidden="true" class="header-anchor">#</a> 利用 reduce 进行数据优化</h2> <h3 id="数组去重"><a href="#数组去重" aria-hidden="true" class="header-anchor">#</a> 数组去重</h3> <p>没错，又是一个老生常谈的问题，数组去重，但是我们这次去除的不仅仅是单个的数据，而是拥有某个相同键值的对象集合。例如下面的例子，我们有以下的数据：</p> <h2 id="牛逼的-reduce"><a href="#牛逼的-reduce" aria-hidden="true" class="header-anchor">#</a> 牛逼的 reduce</h2> <h3 id="数据去重"><a href="#数据去重" aria-hidden="true" class="header-anchor">#</a> 数据去重</h3> <p>首先我们来看看一个老生常谈的问题，我们假设有这样的一个对象：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">&quot;Kris&quot;</span><span class="token punctuation">,</span>
    age<span class="token punctuation">:</span> <span class="token string">&quot;24&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">&quot;Andy&quot;</span><span class="token punctuation">,</span>
    age<span class="token punctuation">:</span> <span class="token string">&quot;25&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">&quot;Kitty&quot;</span><span class="token punctuation">,</span>
    age<span class="token punctuation">:</span> <span class="token string">&quot;25&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">&quot;Andy&quot;</span><span class="token punctuation">,</span>
    age<span class="token punctuation">:</span> <span class="token string">&quot;25&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">&quot;Kitty&quot;</span><span class="token punctuation">,</span>
    age<span class="token punctuation">:</span> <span class="token string">&quot;25&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">&quot;Andy&quot;</span><span class="token punctuation">,</span>
    age<span class="token punctuation">:</span> <span class="token string">&quot;25&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">&quot;Kitty&quot;</span><span class="token punctuation">,</span>
    age<span class="token punctuation">:</span> <span class="token string">&quot;25&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><p>现在我们要去重里面<code>name</code>重复的对象，这时候我们可以利用<code>reduce</code>，例子如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">dataReducer</span> <span class="token operator">=</span> <span class="token punctuation">(</span>prev<span class="token punctuation">,</span> cur<span class="token punctuation">,</span> idx<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> name <span class="token punctuation">}</span> <span class="token operator">=</span> cur<span class="token punctuation">;</span>
  obj<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> cur<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>prev<span class="token punctuation">,</span>
    <span class="token operator">...</span>obj
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> reducedData <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span>dataReducer<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> newData <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span>reducedData<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="批量生成对象元素"><a href="#批量生成对象元素" aria-hidden="true" class="header-anchor">#</a> 批量生成对象元素</h3> <p>在鱼头的实际业务中，有一个操作是需要对类似以下的对象进行操作的：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
    a1<span class="token punctuation">:</span> <span class="token string">'data'</span><span class="token punctuation">,</span>
    a2<span class="token punctuation">:</span> <span class="token string">'data'</span><span class="token punctuation">,</span>
    <span class="token operator">...</span><span class="token punctuation">,</span>
    an<span class="token punctuation">:</span> <span class="token string">'data'</span>
<span class="token punctuation">}</span>
</code></pre></div><p>像我这么懒的鱼，肯定不会一个个手写，所以就有了以下方法</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">createList</span> <span class="token operator">=</span> <span class="token punctuation">(</span>item<span class="token punctuation">,</span> idx<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  obj<span class="token punctuation">[</span><span class="token template-string"><span class="token string">`a</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>idx<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;data&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> obj<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">listReducer</span> <span class="token operator">=</span> <span class="token punctuation">(</span>acc<span class="token punctuation">,</span> cur<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token operator">!</span>acc <span class="token operator">?</span> <span class="token punctuation">{</span> <span class="token operator">...</span>cur <span class="token punctuation">}</span> <span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token operator">...</span>cur<span class="token punctuation">,</span> <span class="token operator">...</span>acc <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> obj <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token keyword">from</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span> createList<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span>listReducer<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>如果你喜欢探讨技术，或者对本文有任何的意见或建议，非常欢迎加鱼头微信好友一起探讨，当然，鱼头也非常希望能跟你一起聊生活，聊爱好，谈天说地。
鱼头的微信号是：krisChans95
也可以扫码关注公众号，订阅更多精彩内容。
<img src="https://fish-pond-1253945200.cos.ap-guangzhou.myqcloud.com/img/base/qrcode-all1.png" alt="https://fish-pond-1253945200.cos.ap-guangzhou.myqcloud.com/img/base/qrcode-all1.png"></p></div> <div class="page-footer content">
    网站备案号：粤ICP备17113436号-1
  </div> <!----> <div class="right-group"><div class="item"><span class="title">加入前端鱼塘</span> <span class="desc">
        扫描二维码回复
        <span class="inner">加群</span> 学习
      </span> <img width="100%" src="https://fish-pond-1253945200.cos.ap-guangzhou.myqcloud.com/img/base/wx-qrcode.jpg"></div></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <div></div></div></div>
    <script src="/assets/js/35.31641123.js" defer></script><script src="/assets/js/app.c5a7454e.js" defer></script>
    <!-- Hotjar Tracking Code for yuchengkai.cn -->
    <script>
      var _hmt = _hmt || []
      ;(function() {
        var hm = document.createElement('script')
        hm.src = 'https://hm.baidu.com/hm.js?52ee35894430604d0d3ce3b9c089adf9'
        var s = document.getElementsByTagName('script')[0]
        s.parentNode.insertBefore(hm, s)
      })()
    </script>
  </body>
</html>
