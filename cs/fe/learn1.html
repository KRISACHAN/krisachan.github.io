<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>2019.7.15 - 7.21 我们 36人都学了些什么？ | 鱼头的海上世界</title>
    <meta name="description" content="kris&#39;s area">
    <link rel="icon" href="/favicon.ico">
    
    <link rel="preload" href="/assets/css/styles.a889baa8.css" as="style"><link rel="preload" href="/assets/js/app.a889baa8.js" as="script"><link rel="preload" href="/assets/js/4.3240f5bb.js" as="script"><link rel="prefetch" href="/assets/js/1.f7d4e4c9.js"><link rel="prefetch" href="/assets/js/10.f6412d06.js"><link rel="prefetch" href="/assets/js/11.0e34853d.js"><link rel="prefetch" href="/assets/js/12.f6a54407.js"><link rel="prefetch" href="/assets/js/13.1a57bcba.js"><link rel="prefetch" href="/assets/js/14.ee55fc65.js"><link rel="prefetch" href="/assets/js/15.2221876b.js"><link rel="prefetch" href="/assets/js/16.d03399b9.js"><link rel="prefetch" href="/assets/js/17.ee1e93b1.js"><link rel="prefetch" href="/assets/js/18.1e2ef11b.js"><link rel="prefetch" href="/assets/js/19.3f29f73c.js"><link rel="prefetch" href="/assets/js/2.70d0a8fd.js"><link rel="prefetch" href="/assets/js/20.3cbfdfde.js"><link rel="prefetch" href="/assets/js/21.da7eb035.js"><link rel="prefetch" href="/assets/js/22.2e960d47.js"><link rel="prefetch" href="/assets/js/23.ae9ac59d.js"><link rel="prefetch" href="/assets/js/24.b0c05115.js"><link rel="prefetch" href="/assets/js/25.a7c37585.js"><link rel="prefetch" href="/assets/js/26.4d9adb05.js"><link rel="prefetch" href="/assets/js/27.f3918751.js"><link rel="prefetch" href="/assets/js/28.c884c02e.js"><link rel="prefetch" href="/assets/js/29.a4fb8ef7.js"><link rel="prefetch" href="/assets/js/3.0d8046fe.js"><link rel="prefetch" href="/assets/js/30.8e8f6e65.js"><link rel="prefetch" href="/assets/js/31.93da6cd7.js"><link rel="prefetch" href="/assets/js/5.d5a19b1d.js"><link rel="prefetch" href="/assets/js/6.27a2a4ef.js"><link rel="prefetch" href="/assets/js/7.f2e1b44b.js"><link rel="prefetch" href="/assets/js/8.8b50a45d.js"><link rel="prefetch" href="/assets/js/9.ad9c7d6c.js">
    <link rel="stylesheet" href="/assets/css/styles.a889baa8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/" class="home-link router-link-active"><!----><span class="site-name">
      鱼头的海上世界
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><!----></div></header><div class="sidebar-mask"></div><div class="sidebar"><!----><ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>2019.7.15 - 7.21 我们 36人都学了些什么？</span><!----></p><ul class="sidebar-group-items"><li><a href="/cs/fe/learn1.html#css" class="sidebar-link">CSS</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cs/fe/learn1.html#css-houdini" class="sidebar-link">CSS Houdini</a></li></ul></li><li><a href="/cs/fe/learn1.html#js" class="sidebar-link">JS</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cs/fe/learn1.html#另类的数组求和" class="sidebar-link">另类的数组求和</a></li><li class="sidebar-sub-header"><a href="/cs/fe/learn1.html#数组完全展开" class="sidebar-link">数组完全展开</a></li><li class="sidebar-sub-header"><a href="/cs/fe/learn1.html#实现-sleep-函数" class="sidebar-link">实现 sleep 函数</a></li><li class="sidebar-sub-header"><a href="/cs/fe/learn1.html#正则过滤违规词" class="sidebar-link">正则过滤违规词</a></li></ul></li><li><a href="/cs/fe/learn1.html#node" class="sidebar-link">Node</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cs/fe/learn1.html#开启-gzip" class="sidebar-link">开启 Gzip</a></li><li class="sidebar-sub-header"><a href="/cs/fe/learn1.html#统计-git-代码行数" class="sidebar-link">统计 Git 代码行数</a></li><li class="sidebar-sub-header"><a href="/cs/fe/learn1.html#实现一个only函数" class="sidebar-link">实现一个only函数</a></li></ul></li><li><a href="/cs/fe/learn1.html#实际业务问题" class="sidebar-link">实际业务问题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cs/fe/learn1.html#视频兼容相关" class="sidebar-link">视频兼容相关</a></li><li class="sidebar-sub-header"><a href="/cs/fe/learn1.html#聊天数据渲染" class="sidebar-link">聊天数据渲染</a></li><li class="sidebar-sub-header"><a href="/cs/fe/learn1.html#链表作为聊天数据的载体" class="sidebar-link">链表作为聊天数据的载体</a></li></ul></li><li><a href="/cs/fe/learn1.html#总结" class="sidebar-link">总结</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cs/fe/learn1.html#工作中建立起来的一些心得" class="sidebar-link">工作中建立起来的一些心得</a></li><li class="sidebar-sub-header"><a href="/cs/fe/learn1.html#最后" class="sidebar-link">最后</a></li></ul></li></ul></div></li></ul></div><div class="page"><div class="content"><h1 id="_2019-7-15-7-21-我们-36人都学了些什么？"><a href="#_2019-7-15-7-21-我们-36人都学了些什么？" aria-hidden="true" class="header-anchor">#</a> 2019.7.15 - 7.21 我们 36人都学了些什么？</h1><blockquote><ul><li>作者：陈大鱼头</li><li>github： <a href="https://github.com/KRISACHAN" target="_blank" rel="noopener noreferrer">KRISACHAN<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></blockquote><p>如果不希望职业生涯过早结束，持续学习对于开发者来说是必不可少的。</p><p>最近《前端面试之道》的作者为了让一些人能在这块地方记录自己学习到的内容而建立起了一个学习仓库。</p><p>仓库地址如下：</p><p><a href="https://github.com/KieSun/today-i-learned" target="_blank" rel="noopener noreferrer">https://github.com/KieSun/today-i-learned<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><p>这些内容通常会是一个小点，可能并不足以写成一篇文章。但是这个知识点可能很多人也不知道，那么通过这种记录的方式让别人同样也学习到这个知识点就是一个很棒的事情了。</p><p>具体的知识点如下：</p><h2 id="css"><a href="#css" aria-hidden="true" class="header-anchor">#</a> CSS</h2><h3 id="css-houdini"><a href="#css-houdini" aria-hidden="true" class="header-anchor">#</a> CSS Houdini</h3><p>我们在日常开发中可能会用到过许多 <code>CSS IN JS</code> 或者 <code>CSS module</code> 的方案，但是 <code>JS IN CSS</code> ，你听说过吗？</p><p>CSS Houdini 是由一群來自各个国际大厂的工程师所组成的工作小组，志在建立一系列的 API来让开发者能够介入浏览器的CSS引擎中，用来解決 CSS 长久以来的问题。</p><p>例子如下：</p><p>我们首先定义一个JS文件叫<code>houdini.js</code>，一个HTML文件叫<code>index.html</code>。</p><p><code>houdini.js</code> 文件内容如下：</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token string">'use strict'</span>
<span class="token function">registerPaint</span><span class="token punctuation">(</span><span class="token string">'overdraw'</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">get</span> <span class="token function">inputProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token string">'--border-width'</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token function">paint</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> geom<span class="token punctuation">,</span> properties<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> borderWidth <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>properties<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'--border-width'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ctx<span class="token punctuation">.</span>shadowColor <span class="token operator">=</span> <span class="token string">'rgba(0,0,0,0.25)'</span><span class="token punctuation">;</span>
        ctx<span class="token punctuation">.</span>shadowBlur <span class="token operator">=</span> borderWidth<span class="token punctuation">;</span>

        ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">'rgba(255, 255, 255, 1)'</span><span class="token punctuation">;</span>
        ctx<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span>borderWidth<span class="token punctuation">,</span>
                     borderWidth<span class="token punctuation">,</span>
                     geom<span class="token punctuation">.</span>width <span class="token operator">-</span> <span class="token number">2</span> <span class="token operator">*</span> borderWidth<span class="token punctuation">,</span>
                     geom<span class="token punctuation">.</span>height <span class="token operator">-</span> <span class="token number">2</span> <span class="token operator">*</span> borderWidth<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><code>index.html</code> 文件内容如下：</p><div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>utf-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>screen-orientation<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>portrait<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>x5-orientation<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>portrait<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>X-UA-Compatible<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>IE=edge,chrome=1<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Cache-Control<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>no-siteapp<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>demo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style language-css">
      <span class="token selector">.overdraw</span> <span class="token punctuation">{</span>
        <span class="token property">--border-width</span><span class="token punctuation">:</span> 10<span class="token punctuation">;</span>
        <span class="token property">border-style</span><span class="token punctuation">:</span> solid<span class="token punctuation">;</span>
        <span class="token property">border-width</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--border-width<span class="token punctuation">)</span> * 1px<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token property">border-image-source</span><span class="token punctuation">:</span> <span class="token function">paint</span><span class="token punctuation">(</span>overdraw<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token property">border-image-slice</span><span class="token punctuation">:</span> 0 fill<span class="token punctuation">;</span>
        <span class="token property">border-image-outset</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--border-width<span class="token punctuation">)</span> * 1px<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token property">width</span><span class="token punctuation">:</span> 200px<span class="token punctuation">;</span>
        <span class="token property">height</span><span class="token punctuation">:</span> 200px<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>overdraw<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript">
      <span class="token string">'use strict'</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span><span class="token constant">CSS</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token constant">CSS</span><span class="token punctuation">.</span>paintWorklet<span class="token punctuation">.</span><span class="token function">addModule</span><span class="token punctuation">(</span><span class="token string">'houdnini.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>然后开个静态服务器，就可以看效果了，效果如下：</p><p><img src="https://camo.githubusercontent.com/c7c3b510ddb9d038bce87b31a120c8b876cd01f7/68747470733a2f2f75706c6f61642d696d616765732e6a69616e7368752e696f2f75706c6f61645f696d616765732f333338383039332d326265613330313031613563393664392e706e673f696d6167654d6f6772322f6175746f2d6f7269656e742f7374726970253743696d61676556696577322f322f772f3232302f666f726d61742f77656270" alt></p><h2 id="js"><a href="#js" aria-hidden="true" class="header-anchor">#</a> JS</h2><h3 id="另类的数组求和"><a href="#另类的数组求和" aria-hidden="true" class="header-anchor">#</a> 另类的数组求和</h3><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span>
<span class="token function">eval</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'+'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="数组完全展开"><a href="#数组完全展开" aria-hidden="true" class="header-anchor">#</a> 数组完全展开</h3><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">myFlat</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span>t <span class="token operator">=&gt;</span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       arr <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>concat<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> arr<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> arr<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> arrTest1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  
<span class="token comment">// Expected Output: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">myFlat</span><span class="token punctuation">(</span>arrTest1<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="实现-sleep-函数"><a href="#实现-sleep-函数" aria-hidden="true" class="header-anchor">#</a> 实现 sleep 函数</h3><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">sleep</span><span class="token punctuation">(</span>interval<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span>resolve <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> interval<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> index <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> index<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="正则过滤违规词"><a href="#正则过滤违规词" aria-hidden="true" class="header-anchor">#</a> 正则过滤违规词</h3><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> ma <span class="token operator">=</span> <span class="token string">&quot;大傻逼&quot;</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> regstr <span class="token operator">=</span> ma<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'([^\u4e00-\u9fa5]*?)'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> str <span class="token operator">=</span> <span class="token string">&quot;这是一篇文章,需要过滤掉大傻逼这三个词,大傻逼中间出汉字以外的字符 大_/_傻a1v逼和 大傻a1v逼&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> reg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span>regstr <span class="token punctuation">,</span> <span class="token string">'g'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
str<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>reg<span class="token punctuation">,</span><span class="token string">&quot;&lt;替换的词&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="node"><a href="#node" aria-hidden="true" class="header-anchor">#</a> Node</h2><h3 id="开启-gzip"><a href="#开启-gzip" aria-hidden="true" class="header-anchor">#</a> 开启 Gzip</h3><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> compression <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'compression'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">compression</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="统计-git-代码行数"><a href="#统计-git-代码行数" aria-hidden="true" class="header-anchor">#</a> 统计 Git 代码行数</h3><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> exec <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'child_process'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> argv <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'yargs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">readLines</span> <span class="token operator">=</span> stdout <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> stringArray <span class="token operator">=</span> stdout
    <span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token regex">/(\n)/g</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>str <span class="token operator">=&gt;</span> str <span class="token operator">!==</span> <span class="token string">'\n'</span> <span class="token operator">&amp;&amp;</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> dataArray <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  stringArray<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>str <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> data <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token regex">/(\t)/g</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>str <span class="token operator">=&gt;</span> str <span class="token operator">!==</span> <span class="token string">'\t'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>newLine<span class="token punctuation">,</span> deletedLine<span class="token punctuation">,</span> filePath<span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">;</span>
    dataArray<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> newLine<span class="token punctuation">,</span> deletedLine<span class="token punctuation">,</span> filePath <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> dataArray<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>


<span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>argv<span class="token punctuation">.</span>commit<span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
  <span class="token function">exec</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`git diff </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>argv<span class="token punctuation">.</span>commit<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> --numstat`</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span>error<span class="token punctuation">,</span> stdout<span class="token punctuation">,</span> stderr<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token function">readLines</span><span class="token punctuation">(</span>stdout<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="实现一个only函数"><a href="#实现一个only函数" aria-hidden="true" class="header-anchor">#</a> 实现一个only函数</h3><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">'tobi'</span><span class="token punctuation">,</span>
    last<span class="token punctuation">:</span> <span class="token string">'holowaychuk'</span><span class="token punctuation">,</span>
    email<span class="token punctuation">:</span> <span class="token string">'tobi@learnboost.com'</span><span class="token punctuation">,</span>
    _id<span class="token punctuation">:</span> <span class="token string">'12345'</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">only</span> <span class="token operator">=</span> <span class="token punctuation">(</span>obj<span class="token punctuation">,</span> para<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>obj <span class="token operator">||</span> <span class="token operator">!</span>para<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'please check your args!'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token keyword">let</span> newObj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> newArr <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>para<span class="token punctuation">)</span> <span class="token operator">?</span> para <span class="token punctuation">:</span> <span class="token keyword">typeof</span> <span class="token punctuation">(</span>para<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'string'</span> <span class="token operator">?</span> para<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token regex">/ +/</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    newArr<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>item <span class="token operator">&amp;&amp;</span> obj<span class="token punctuation">[</span>item<span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>newObj<span class="token punctuation">[</span>item<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            newObj<span class="token punctuation">[</span>item<span class="token punctuation">]</span> <span class="token operator">=</span> obj<span class="token punctuation">[</span>item<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> newObj<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// {email: &quot;tobi@learnboost.com&quot;, last: &quot;holowaychuk&quot;, name: &quot;tobi&quot;}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">only</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'last'</span><span class="token punctuation">,</span> <span class="token string">'email'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">only</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">'name last    email'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="实际业务问题"><a href="#实际业务问题" aria-hidden="true" class="header-anchor">#</a> 实际业务问题</h2><h3 id="视频兼容相关"><a href="#视频兼容相关" aria-hidden="true" class="header-anchor">#</a> 视频兼容相关</h3><p>在安卓中，直接使用原生 video 会导致全屏播放，盖住所有元素，因此使用 x5 播放器。但是 x5 播放器还是存在问题，虽然不会盖住元素，但是会自己添加特效（盖一层导航栏蒙层）。</p><div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>video</span>
  <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>live-detail__video vjs-big-play-centered<span class="token punctuation">'</span></span>
  <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>live-player<span class="token punctuation">'</span></span>
  <span class="token attr-name">controls</span><span class="token attr-value"><span class="token punctuation">=</span>{false}</span>
  <span class="token attr-name">playsInline</span>
  <span class="token attr-name">webkit-playsinline</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>true<span class="token punctuation">'</span></span>
  <span class="token attr-name">x5-video-player-type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>h5<span class="token punctuation">'</span></span>
  <span class="token attr-name">x5-video-orientation</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>portrait<span class="token punctuation">'</span></span>
  <span class="token attr-name">x5-playsinline</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>true<span class="token punctuation">'</span></span>
  <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation">=</span>{style}</span>
<span class="token punctuation">/&gt;</span></span>
</code></pre></div><p>这样可以在安卓下使用 x5 播放器， <code>playsInline</code> 及 <code>webkit-playsinline</code> 属性可以在 iOS 环境下启用内联播放。但是通过属性设置内联播放兼容性并不怎么好，所以这时候我们需要使用 iphone-inline-video[2] 这个库，通过 <code>enableInlineVideo(video)</code> 就可以了。</p><h3 id="聊天数据渲染"><a href="#聊天数据渲染" aria-hidden="true" class="header-anchor">#</a> 聊天数据渲染</h3><p>考虑到直播中聊天数据频繁，因此所有接收到的数据会先存入一个数组 buffer 中，等待 2 秒后统一渲染。</p><div class="language-javascript extra-class"><pre class="language-javascript"><code>
<span class="token comment">// 接收到消息就先 push 到缓存数组中</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>bufferAllComments<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  customerName<span class="token punctuation">:</span> fromCustomerName<span class="token punctuation">,</span>
  commentId<span class="token punctuation">,</span>
  content<span class="token punctuation">,</span>
  commentType
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 利用定时器，每两秒将数组中的中的 concat 到当前聊天数据中并清空缓存</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>commentTimer <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>bufferAllComments<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">appendChatData</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>bufferAllComments<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>bufferAllComments <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="链表作为聊天数据的载体"><a href="#链表作为聊天数据的载体" aria-hidden="true" class="header-anchor">#</a> 链表作为聊天数据的载体</h3><p>同样考虑到直播中聊天数据频繁插入，因此使用链表来存储显示的聊天数据，目前只存储 50 条数据，这样删除前面的只要很简单。</p><ul><li>使用链表的原因是考虑到频繁的去除数组头部数据去造成空间复杂度的问题</li><li>另外也实现了支持迭代器的功能，代码如下：</li></ul><div class="language-javascript extra-class"><pre class="language-javascript"><code>
<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> current <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token keyword">let</span> target <span class="token operator">=</span> <span class="token keyword">this</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token function">next</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      current <span class="token operator">=</span> current <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> current<span class="token punctuation">.</span>next <span class="token punctuation">:</span> target<span class="token punctuation">.</span>head
      <span class="token keyword">if</span> <span class="token punctuation">(</span>current <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span> value<span class="token punctuation">:</span> current<span class="token punctuation">.</span>value<span class="token punctuation">,</span> done<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span> value<span class="token punctuation">:</span> undefined<span class="token punctuation">,</span> done<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span> done<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="总结"><a href="#总结" aria-hidden="true" class="header-anchor">#</a> 总结</h2><h3 id="工作中建立起来的一些心得"><a href="#工作中建立起来的一些心得" aria-hidden="true" class="header-anchor">#</a> 工作中建立起来的一些心得</h3><ol><li><p>要根据任务四象限划分好每天要做的事，按紧急度去完成任务（重要紧急，重要不紧急，紧急不重要，不重要不紧急）；</p></li><li><p>学会自我总结（写周报或日志汇总所遇到的问题，时刻翻阅）；</p></li><li><p>拥有快速定位并解决问题的能力（通过已知的条件去判断所遇到的问题）；</p></li><li><p>要多与上下游沟通，了解团队大家所做的事以及进度（方便自己合理安排任务）；</p></li><li><p>积极乐观不抱怨（最好可以时常给团队带来正能量，而不是满腹抱怨）；</p></li><li><p>多运动，多休息（身体革命的本钱，没有一个好的身体就什么都做不了）。</p></li></ol><h3 id="最后"><a href="#最后" aria-hidden="true" class="header-anchor">#</a> 最后</h3><p>这是一个需要大家一起分享才能持续下去的事情，光靠我，YCK或者少量几个人分享是做不下去的。欢迎大家参与到这件事情中来，地址如下：</p><p><a href="https://github.com/KieSun/today-i-learned" target="_blank" rel="noopener noreferrer">https://github.com/KieSun/today-i-learned<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><br><br>
如果你、喜欢探讨技术，或者对本文有任何的意见或建议，你可以扫描下方二维码，关注微信公众号“<b>鱼头的Web海洋</b>”，随时与鱼头互动。欢迎！衷心希望可以遇见你。
<br><br><img src="/img/qrcode-base.png" style="margin: 24px auto;display: block; font-size: 0; vertical-align: middle;"></div><div class="page-edit"><!----><!----></div><!----></div></div></div>
    <script src="/assets/js/app.a889baa8.js" defer></script><script src="/assets/js/4.3240f5bb.js" defer></script>
  </body>
</html>
